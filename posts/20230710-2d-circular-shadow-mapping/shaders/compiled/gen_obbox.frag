#version 300 es
precision highp float;precision highp int;uniform highp usampler2D lightingData;uniform highp sampler2D lightPlaneMap;layout(location=0)out uvec4 outOOBox;vec3 _;void main(){int a=int(gl_FragCoord.x);highp vec2 b=uintBitsToFloat(texelFetch(lightingData,ivec2(a,0),0).xy);ivec2 c=textureSize(lightPlaneMap,0);int d=c.x;highp float e=uintBitsToFloat(2130706432u-floatBitsToUint(float(d)))*6.2831855;highp vec2 f;f=vec2(0.);highp float g;highp vec2 h;int i=0;highp float j=-65504.;for(;i<d;j=g,f=h,i++){highp vec2 k;highp vec4 l=texelFetch(lightPlaneMap,ivec2(i,a),0);highp vec2 m=(l.xy*2.)-vec2(1.);highp vec3 n=_;n.x=m.x;highp vec3 o=n;o.y=m.y;highp float p=float(i);highp float q=(p-1.)*e;highp vec2 r;do{highp vec2 s=vec2(cos(q),sin(q));k=o.xy;highp float t=dot(k,s);if(abs(t)<=.017452406){r=vec2(0.);break;}r=s*(l.z/t);break;}while(false);highp float u=dot(r,r);highp float v=(p+1.)*e;highp vec2 w;do{highp vec2 x=vec2(cos(v),sin(v));highp float y=dot(k,x);if(abs(y)<=.017452406){w=vec2(0.);break;}w=x*(l.z/y);break;}while(false);highp float z=dot(w,w);bool A=u>j;bvec2 B=bvec2(A);highp vec2 C=vec2(B.x?r.x:f.x,B.y?r.y:f.y);highp float D=A?u:j;bool E=z>D;g=E?z:D;bvec2 F=bvec2(E);h=vec2(F.x?w.x:C.x,F.y?w.y:C.y);}highp vec2 G;G=vec2(0.);highp float H;highp vec2 I;int J=0;highp float K=-65504.;for(;J<d;K=H,G=I,J++){highp vec2 L;highp vec4 M=texelFetch(lightPlaneMap,ivec2(J,a),0);highp vec2 N=(M.xy*2.)-vec2(1.);highp vec3 O=_;O.x=N.x;highp vec3 P=O;P.y=N.y;highp float Q=float(J);highp float R=(Q-1.)*e;highp vec2 S;do{highp vec2 T=vec2(cos(R),sin(R));L=P.xy;highp float U=dot(L,T);if(abs(U)<=.017452406){S=vec2(0.);break;}S=T*(M.z/U);break;}while(false);highp vec2 V=S-f;highp float W=dot(V,V);highp float X=(Q+1.)*e;highp vec2 Y;do{highp vec2 Z=vec2(cos(X),sin(X));highp float a_=dot(L,Z);if(abs(a_)<=.017452406){Y=vec2(0.);break;}Y=Z*(M.z/a_);break;}while(false);highp vec2 b_=Y-f;bool c_=W>K;bvec2 d_=bvec2(c_);highp vec2 e_=vec2(d_.x?S.x:G.x,d_.y?S.y:G.y);H=c_?W:K;bvec2 f_=bvec2(dot(b_,b_)>H);I=vec2(f_.x?Y.x:e_.x,f_.y?Y.y:e_.y);}highp vec2 g_=normalize(G-f);highp vec2 h_=vec2(g_.y,-g_.x);highp float i_=dot(h_,f);highp float j_;highp float k_;k_=0.;j_=0.;highp float l_;highp float m_;for(int n_=0;n_<d;k_=m_,j_=l_,n_++){highp vec2 o_;highp vec4 p_=texelFetch(lightPlaneMap,ivec2(n_,a),0);highp vec2 q_=(p_.xy*2.)-vec2(1.);highp vec3 r_=_;r_.x=q_.x;highp vec3 s_=r_;s_.y=q_.y;highp float t_=float(n_);highp float u_=(t_-1.)*e;highp vec2 v_;do{highp vec2 w_=vec2(cos(u_),sin(u_));o_=s_.xy;highp float x_=dot(o_,w_);if(abs(x_)<=.017452406){v_=vec2(0.);break;}v_=w_*(p_.z/x_);break;}while(false);highp float y_=dot(v_,h_)-i_;highp float z_=(t_+1.)*e;highp vec2 A_;do{highp vec2 B_=vec2(cos(z_),sin(z_));highp float C_=dot(o_,B_);if(abs(C_)<=.017452406){A_=vec2(0.);break;}A_=B_*(p_.z/C_);break;}while(false);highp float D_=dot(A_,h_)-i_;highp float E_;highp float F_;if(y_<0.){F_=(abs(y_)>abs(j_))?y_:j_;E_=k_;}else{F_=j_;E_=(y_>k_)?y_:k_;}if(D_<0.){m_=E_;l_=(abs(D_)>abs(F_))?D_:F_;}else{m_=(D_>E_)?D_:E_;l_=F_;}}highp vec2 G_=h_*j_;highp vec2 H_=h_*k_;outOOBox=uvec4(packHalf2x16((f+G_)+b),packHalf2x16((f+H_)+b),packHalf2x16((G+H_)+b),packHalf2x16((G+G_)+b));}