<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=author content="Alister Chowdhury"><meta name=theme-color content=#2b2b2b><link href=/css.css rel=stylesheet><meta name=viewport content="width=device-width, initial-scale=1"><title>Bluenoise Generator</title><meta name=description content="WEGBL2 Bluenoise generator, using a void and cluster variant."><meta name=keywords content="bluenoise, void and cluster, rendering, dithering, low discrepancy sequence"><style>#notSupportedBrowser{display:none}#viewportWrapper{width:50%;height:50%;position:relative;min-width:64px;min-height:64px;margin-left:auto;margin-right:auto}#viewportResizer{cursor:se-resize;right:2px;bottom:2px;width:20px;height:20px;background:url(/res/resize.svg),#d3d3d3;position:absolute}#viewportFullscreen{cursor:pointer;right:26px;bottom:2px;width:20px;height:20px;background:url(/res/fullscreen.svg),#d3d3d3;position:absolute}#bluenoiseViewport{width:100%;height:100%;margin:0;padding:0}#progressWrapper{display:block;position:relative;width:100%;margin-top:5px;background-color:#d3d3d3;margin-left:auto;margin-right:auto}#progressBar{width:0;height:1.2em;border:0;background-color:#3c3c3c}#progressPercent{position:absolute;display:inline-block;text-align:center;color:#fff;font-weight:bold;mix-blend-mode:difference;padding:0;margin:0}#controls{text-align:center;margin-left:auto;margin-right:auto;width:min-content}#controlsTable{margin-left:auto;margin-right:auto;white-space:nowrap}#controlsTable input[type="number"]{width:5em}#controlsButtons{display:flex;flex-wrap:wrap;justify-content:center;flex-direction:column}#controlsButtons>input{margin-bottom:.5em}.sigmaVisContainer{display:flex;flex-wrap:wrap;justify-content:center}.sigmaVisContainer>div{margin:5px;text-align:center}.sigmaVisContainer>div>img{width:64px;height:64px;-ms-interpolation-mode:nearest-neighbor;image-rendering:crisp-edges;image-rendering:pixelated}</style><script type=module>import{onResourcesLoaded as e,bindBluenoiseContext as o}from"./void_and_cluster_webgl2.js";e(()=>{window.bindBluenoiseContext=o});</script><script>async function injectJavascriptAsync(e,t){let n=document.createElement("script");n.src=e,n.onload=t,document.body.appendChild(n)}class UISliderSync{constructor(e,t,n){this.f=e,this.slider=t,this.value=n,this.syncing=!1}syncSlider(){this.sync(this.slider,this.value)}syncValue(){this.sync(this.value,this.slider)}sync(e,t){if(this.syncing)return;this.syncing=!0;let n=document.getElementById(e).value;document.getElementById(t).value=n,null!=this.f&&this.f(n),this.syncing=!1}}function getViewport(){return document.getElementById("bluenoiseViewport")}function getViewportCtx(){return window.bindBluenoiseContext(getViewport())}function initNewRenderingContext(){getViewportCtx().newRenderingContext(),document.getElementById("savePng").disabled=!0,document.getElementById("saveBC4").disabled=!0}function setViewportSettings(e,t){let n=getViewportCtx();n.settings[e]=t,n.webBrowserSupported&&initNewRenderingContext()}function toggleTiledVisualisation(){let e=document.getElementById("visTiled").checked,t=getViewportCtx();t.settings.visTiled=e,t.forceRefresh=!0}var _THIRD_PARTY_PNG_LIBS_LOADED=0,_BLOCK_SAVE_PNG=0;function saveBluenoisePng(){if(1==_BLOCK_SAVE_PNG)return;if(_BLOCK_SAVE_PNG=1,0==_THIRD_PARTY_PNG_LIBS_LOADED){injectJavascriptAsync("/thirdparty/UZIP.min.js",function(){injectJavascriptAsync("/thirdparty/pako.min.js",function(){injectJavascriptAsync("/thirdparty/UPNG.min.js",function(){_THIRD_PARTY_PNG_LIBS_LOADED=1,_BLOCK_SAVE_PNG=0,saveBluenoisePng()})})});return}let e=getViewportCtx(),t=e.activeDimensions(),n=e.readBlueNoiseRaw(e.GL.UNSIGNED_BYTE),i=UPNG.encodeLL([n],t[0],t[1],1,0,8);window.open(URL.createObjectURL(new Blob([i],{type:"image/png"})),"_blank").focus(),_BLOCK_SAVE_PNG=0}function saveBluenoiseBC4(){let e=getViewportCtx(),t=e.readBlueNoiseBC4();window.open(URL.createObjectURL(new Blob([t.buffer],{type:"application/octet-stream"})),"_blank").focus()}function mainUpdateLoop(){let e=getViewportCtx();if(e.webBrowserSupported){let t=!e.done();e.update(),window.requestAnimationFrame(mainUpdateLoop);var n=document.getElementById("progressBar");document.getElementById("progressPercent");let i=e.progress();if(n.style.width=`${100*i}%`,progressPercent.innerHTML=`${Math.round(100*i)}%`,t&&e.done()){let r=e.activeDimensions();document.getElementById("savePng").disabled=!1,document.getElementById("saveBC4").disabled=(3&r[0])!=0||(3&r[1])!=0}}}function mainUpdateLoopLauncher(){if(null==window.bindBluenoiseContext||null==getViewport())window.requestAnimationFrame(mainUpdateLoopLauncher);else{let e=getViewportCtx();if(!e.webBrowserSupported){document.getElementById("supportedBrowser").style.display="none";var t=document.getElementById("notSupportedBrowser");t.style.display="block",t.innerHTML="Unfortunately your browser is not supported:<br>"+e.noSupportReason+"<br>Sorry about that :(";return}initNewRenderingContext(),mainUpdateLoop();let n=["newBlueNoise","visTiled","sigmaSlider","sigmaValue","accuracySlider","accuracyValue","widthSlider","widthValue","heightSlider","heightValue",];for(var i=0;i<n.length;++i)document.getElementById(n[i]).disabled=!1}}_SIGMA_UI_SYNC=new UISliderSync(function(e){setViewportSettings("sigma",e)},"sigmaSlider","sigmaValue"),_ACCURACY_UI_SYNC=new UISliderSync(function(e){setViewportSettings("updateAccuracy",e)},"accuracySlider","accuracyValue"),_WIDTH_UI_SYNC=new UISliderSync(function(e){setViewportSettings("width",Math.max(1,Math.round(e)))},"widthSlider","widthValue"),_HEIGHT_UI_SYNC=new UISliderSync(function(e){setViewportSettings("height",Math.max(1,Math.round(e)))},"heightSlider","heightValue");</script><link rel=stylesheet href=/thirdparty/katex.min.css></head><body onload=mainUpdateLoopLauncher()> <div id=header> <a href=/>Home</a> <a href=/posts/>Posts</a> <a href=https://github.com/alister-chowdhury>Github</a> </div> <div id=supportedBrowser> <div id=viewportWrapper> <canvas id=bluenoiseViewport></canvas> <div id=viewportFullscreen title=Fullscreen onclick=getViewport().requestFullscreen()></div> <div id=viewportResizer title="Resize viewport"></div> </div> <div id=controls> <div id=progressWrapper> <span id=progressPercent></span> <div id=progressBar></div> </div> <table id=controlsTable> <tr> <td id=visTiledLabel>Visualise Tiled</td> <td><input aria-labelledby=visTiledLabel id=visTiled disabled type=checkbox checked onchange=toggleTiledVisualisation() oninput=toggleTiledVisualisation()></td> </tr> <tr> <td id=sigmaLabel>Sigma</td> <td> <input aria-labelledby=sigmaLabel id=sigmaSlider disabled type=range min=1 max=3 value=1.9 step=0.01 onchange=_SIGMA_UI_SYNC.syncSlider() oninput=_SIGMA_UI_SYNC.syncSlider()> <input aria-labelledby=sigmaLabel id=sigmaValue disabled type=number value=1.9 step=0.1 onchange=_SIGMA_UI_SYNC.syncValue() oninput=_SIGMA_UI_SYNC.syncValue()> </td> </tr> <tr> <td id=accuracyLabel>Accuracy</td> <td> <input aria-labelledby=accuracyLabel id=accuracySlider disabled type=range min=0.5 max=1 value=0.9 step=0.0001 onchange=_ACCURACY_UI_SYNC.syncSlider() oninput=_ACCURACY_UI_SYNC.syncSlider()> <input aria-labelledby=accuracyLabel id=accuracyValue disabled type=number value=0.9 step=0.0001 onchange=_ACCURACY_UI_SYNC.syncValue() oninput=_ACCURACY_UI_SYNC.syncValue()> </td> </tr> <tr> <td id=widthLabel>Width</td> <td> <input aria-labelledby=widthLabel id=widthSlider disabled type=range min=4 max=512 value=64 step=1 onchange=_WIDTH_UI_SYNC.syncSlider() oninput=_WIDTH_UI_SYNC.syncSlider()> <input aria-labelledby=widthLabel id=widthValue disabled type=number value=64 step=1 min=1 max=65535 onchange=_WIDTH_UI_SYNC.syncValue()> </td> </tr> <tr> <td id=heightLabel>Height</td> <td> <input aria-labelledby=heightLabel id=heightSlider disabled type=range min=4 max=512 value=64 step=1 onchange=_HEIGHT_UI_SYNC.syncSlider() oninput=_HEIGHT_UI_SYNC.syncSlider()> <input aria-labelledby=heightLabel id=heightValue disabled type=number value=64 step=1 min=1 max=65535 onchange=_HEIGHT_UI_SYNC.syncValue()> </td> </tr> </table> <br> <div id=controlsButtons> <input type=button id=newBlueNoise value="Generate New Bluenoise" disabled onclick=initNewRenderingContext()>  <input type=button id=savePng value="Save (PNG)" disabled onclick=saveBluenoisePng()> <input type=button id=saveBC4 value="Save (BC4 compressed)" disabled onclick=saveBluenoiseBC4()> </div> </div> </div> <div id=notSupportedBrowser> </div> <br> <main> <h2><ins>Background</ins></h2> <p>Bluenoise textures are commonly used in rendering to effectively mask a lack of samples via dithering.<br> The method used to generate bluenoise here is a variant of <a target=_blank href=http://cv.ulichney.com/papers/1993-void-cluster.pdf>void-and-cluster</a>, first described by Robert Ulichney (1993).<br> I'd also recommend giving the following articles a read over if you're more interested in a bit more background:</p> <ul> <li><a target=_blank href=https://blog.demofox.org/2019/06/25/generating-blue-noise-textures-with-void-and-cluster/>Generating Blue Noise Textures With Void And Cluster</a> by Demofox (June 25, 2019).</li> <li><a target=_blank href=https://bartwronski.com/2021/04/21/superfast-void-and-cluster-blue-noise-in-python-numpy-jax/>Superfast void-and-cluster Blue Noise in Python (Numpy/Jax)</a> by Bart Wronski (April 21, 2021).</li> </ul> <h2><ins>Algorithm Overview</ins></h2> <h3><ins>1. Seeding</ins></h3> <p>In order to make void and cluster non-deterministic, you typically seed points.<br> This does not seed points, but rather it seeds a very small amount of background energy [0, 1.08420210e-19] to each pixel.<br> This satisfies non-determinism, while also not noticeably biasing actually filled points and can be done in a single pass on the GPU.<br> <a target=_blank href=https://github.com/alister-chowdhury/alister-chowdhury.github.io/blob/master/_source/posts/20221230_bluenoise/shaders/void_and_cluster_init.frag>void_and_cluster_init.frag</a></p> <h3><ins>2. The Main Loop</ins></h3> <p>Each pixel of the final image should be a unique value, with the first value written being 1 and the last value written 0.<br> e.g, if we have a 3x3 image, the values and their order would be:</p> <pre><code>    [1.0, 0.875, 0.75, 0.625, 0.5, 0.375, 0.25, 0.125, 0.0]
</code></pre> <p>We decide which pixel to write to by finding the biggest &quot;void&quot; that hasn't been written to yet.<br> In this case, I reduce the buffers down 8x8 pixels at a time, (64x64 =&gt; 8x8 =&gt; 1x1) and keep track of the biggest voids coordinate.<br> <a target=_blank href=https://github.com/alister-chowdhury/alister-chowdhury.github.io/blob/master/_source/posts/20221230_bluenoise/shaders/void_and_cluster_reduce_init.frag>void_and_cluster_reduce_init.frag</a><br> <a target=_blank href=https://github.com/alister-chowdhury/alister-chowdhury.github.io/blob/master/_source/posts/20221230_bluenoise/shaders/void_and_cluster_reduce_iter.frag>void_and_cluster_reduce_iter.frag</a><br></p> <p>This is then fed into a update routine, where the pixel + surrounding pixels energy are updated.<br> The amount of &quot;energy&quot; a pixel contributes to itself and its neighbours is:<br><br> <span class=katex><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0369em></span><span class=mord><span class=mathnormal>e</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:1.0369em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">−<span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-2.931em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>σ</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-2.931em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">−<span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <br> Where x is the distance to the between pixels.</p> <div class=sigmaVisContainer> <div><img alt="sigma=1.0" src=res/sigma1.0.png><br>&sigma; = 1.0</div> <div><img alt="sigma=1.2" src=res/sigma1.2.png><br>&sigma; = 1.2</div> <div><img alt="sigma=1.4" src=res/sigma1.4.png><br>&sigma; = 1.4</div> <div><img alt="sigma=1.6" src=res/sigma1.6.png><br>&sigma; = 1.6</div> <div><img alt="sigma=1.8" src=res/sigma1.8.png><br>&sigma; = 1.8</div> <div><img alt="sigma=2.0" src=res/sigma2.0.png><br>&sigma; = 2.0</div> <div><img alt="sigma=2.2" src=res/sigma2.2.png><br>&sigma; = 2.2</div> <div><img alt="sigma=2.4" src=res/sigma2.4.png><br>&sigma; = 2.4</div> <div><img alt="sigma=2.6" src=res/sigma2.6.png><br>&sigma; = 2.6</div> <div><img alt="sigma=2.8" src=res/sigma2.8.png><br>&sigma; = 2.8</div> <div><img alt="sigma=3.0" src=res/sigma3.0.png><br>&sigma; = 3.0</div> </div> <br> <a target=_blank href=https://github.com/alister-chowdhury/alister-chowdhury.github.io/blob/master/_source/posts/20221230_bluenoise/shaders/void_and_cluster_partial_update.vert>void_and_cluster_partial_update.vert</a><br> <a target=_blank href=https://github.com/alister-chowdhury/alister-chowdhury.github.io/blob/master/_source/posts/20221230_bluenoise/shaders/void_and_cluster_update.frag>void_and_cluster_update.frag</a><br> <br> <h3><ins>3. Region To Update</ins></h3> <h4><ins>3.a Correct version</ins></h4> <p>We can derive a &quot;true&quot; bounds, given some target accuracy via:<br></p> <p><span class=katex><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:2.3262em;vertical-align:-.9119em></span><span class=mop><span class="op-symbol large-op" style=margin-right:.44445em;position:relative;top:-.0011em>∫</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.4143em><span style=top:-1.7881em;margin-left:-.4445em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style=top:-3.8129em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.9119em></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mop><span class="op-symbol large-op" style=margin-right:.44445em;position:relative;top:-.0011em>∫</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.4143em><span style=top:-1.7881em;margin-left:-.4445em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style=top:-3.8129em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.9119em></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class=mathnormal>e</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:1.0369em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">−<span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-2.931em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-2.931em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>σ</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-2.931em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">−<span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mop><span class="mord mathrm">d</span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class=mathnormal>x</span></span><span class=mspace style=margin-right:.1667em></span><span class=mop><span class="mord mathrm">d</span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class=mathnormal style=margin-right:.03588em>y</span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.7936em;vertical-align:-.686em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.1076em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord>4</span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mathnormal style=margin-right:.03588em>π</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mord><span class=mathnormal style=margin-right:.03588em>σ</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8641em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mop><span class="mord mathrm" style=margin-right:.07778em>erf</span></span><span class=mopen>(</span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.1076em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mathnormal style=margin-right:.03588em>σ</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mathnormal>u</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose>)<span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8641em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> </p> <br> Where u is the span of pixels to update. <br> <br> <br> Feeding in <span class=katex><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class=mord>∞</span></span></span></span> gives us:<br> <span class=katex><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:2.3262em;vertical-align:-.9119em></span><span class=mop><span class="op-symbol large-op" style=margin-right:.44445em;position:relative;top:-.0011em>∫</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.4143em><span style=top:-1.7881em;margin-left:-.4445em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style=top:-3.8129em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">∞</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.9119em></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mop><span class="op-symbol large-op" style=margin-right:.44445em;position:relative;top:-.0011em>∫</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.4143em><span style=top:-1.7881em;margin-left:-.4445em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style=top:-3.8129em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">∞</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.9119em></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class=mathnormal>e</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:1.0369em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">−<span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-2.931em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>y</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-2.931em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>σ</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-2.931em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">−<span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mop><span class="mord mathrm">d</span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class=mathnormal>x</span></span><span class=mspace style=margin-right:.1667em></span><span class=mop><span class="mord mathrm">d</span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class=mathnormal style=margin-right:.03588em>y</span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.7936em;vertical-align:-.686em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.1076em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord>4</span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mathnormal style=margin-right:.03588em>π</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mord><span class=mathnormal style=margin-right:.03588em>σ</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8641em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> <br> <br> <br> We can therefore derive an accuracy percentage by:<br><br> <span class=katex><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">p</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:3.8671em;vertical-align:-1.6836em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.1836em><span style=top:-2.11em><span class=pstrut style=height:3.1076em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.1076em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord>4</span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mathnormal style=margin-right:.03588em>π</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em></span></span></span></span><span class="mclose nulldelimiter"></span><span class=mord><span class=mathnormal style=margin-right:.03588em>σ</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style=top:-3.3376em><span class=pstrut style=height:3.1076em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-4.1836em><span class=pstrut style=height:3.1076em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.1076em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord>4</span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mathnormal style=margin-right:.03588em>π</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em></span></span></span></span><span class="mclose nulldelimiter"></span><span class=mord><span class=mathnormal style=margin-right:.03588em>σ</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mop><span class="mord mathrm" style=margin-right:.07778em>erf</span></span><span class=mopen>(</span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.1076em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mathnormal style=margin-right:.03588em>σ</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mathnormal>u</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose>)<span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.6836em></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.7936em;vertical-align:-.686em></span><span class=mop><span class="mord mathrm" style=margin-right:.07778em>erf</span></span><span class=mopen>(</span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.1076em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mathnormal style=margin-right:.03588em>σ</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mathnormal>u</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose>)<span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8641em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> <br> <br> <br> And to get a usable span:<br><br> <span class=katex><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">u</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.1522em;vertical-align:-.2881em></span><span class=mop><span class="mord mathrm">er</span><span class=mord><span class=mathrm style=margin-right:.07778em>f</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8641em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">−<span class="mord mathrm mtight">1</span></span></span></span></span></span></span></span></span></span><span class=mopen>(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.7519em><span class=svg-align style=top:-3em><span class=pstrut style=height:3em></span><span class=mord style=padding-left:.833em><span class="mord mathnormal">p</span></span></span><span style=top:-2.7119em><span class=pstrut style=height:3em></span><span class=hide-tail style=min-width:.853em;height:1.08em><svg xmlns=http://www.w3.org/2000/svg width=400em height=1.08em viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z"></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2881em></span></span></span></span><span class=mclose>)</span><span class="mord mathnormal" style=margin-right:.03588em>σ</span></span></span></span> <br> <p>e.g:</p> <pre><code>              multiplier         |                update span
    --------------------------------------------------------------------------
    ierf(sqrt(0.5))     ≈ 0.744  | [-ceil(0.744 * sigma), ceil(0.744 * sigma)]
    ierf(sqrt(0.6))     ≈ 0.857  | [-ceil(0.857 * sigma), ceil(0.857 * sigma)]
    ierf(sqrt(0.7))     ≈ 0.986  | [-ceil(0.986 * sigma), ceil(0.986 * sigma)]
    ierf(sqrt(0.8))     ≈ 1.144  | [-ceil(1.144 * sigma), ceil(1.144 * sigma)]
    ierf(sqrt(0.9))     ≈ 1.377  | [-ceil(1.377 * sigma), ceil(1.377 * sigma)]
    ierf(sqrt(0.99))    ≈ 1.981  | [-ceil(1.981 * sigma), ceil(1.981 * sigma)]
    ierf(sqrt(0.999))   ≈ 2.456  | [-ceil(2.456 * sigma), ceil(2.456 * sigma)]
    ierf(sqrt(0.9999))  ≈ 2.862  | [-ceil(2.862 * sigma), ceil(2.862 * sigma)]
    ierf(sqrt(0.99999)) ≈ 3.223  | [-ceil(3.223 * sigma), ceil(3.223 * sigma)]

    With a sigma of 1.9:
    0.5     =&gt; [-2, 2]
    0.6     =&gt; [-2, 2]
    0.7     =&gt; [-2, 2]
    0.8     =&gt; [-3, 3]
    0.9     =&gt; [-3, 3]
    0.99    =&gt; [-4, 4]
    0.999   =&gt; [-5, 5]
    0.9999  =&gt; [-6, 6]
    0.99999 =&gt; [-7, 7]
</code></pre> <p>That being said, anything less than 99.99% very quickly becomes unusable, and as far as UI controls are concerned, is quite unintuitive.<br></p> <h4><ins>3.b More intuitive version</ins></h4> <p>If we flip the problem around and change it to, what is the greatest span we can reach, before floating point precision kicks in and prevents anything from even being written, we just need to solve:</p> <p><span class=katex><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0369em></span><span class=mord><span class=mathnormal>e</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:1.0369em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">−<span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-2.931em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03588em>σ</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-2.931em;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">−<span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03785em>δ</span></span></span></span> <br> Where δ is a very small number (e.g FLT_MIN [2^-149]) and u would be the maximum viable span.<br> <br>From which we can derive: <span class=katex><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">u</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.24em;vertical-align:-.2561em></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.9839em><span class=svg-align style=top:-3.2em><span class=pstrut style=height:3.2em></span><span class=mord style=padding-left:1em><span class=mord>−</span><span class=mspace style=margin-right:.1667em></span><span class=mop>ln</span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.03785em>δ</span><span class=mclose>)</span><span class=mord><span class=mathnormal style=margin-right:.03588em>σ</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style=top:-2.9439em><span class=pstrut style=height:3.2em></span><span class=hide-tail style=min-width:1.02em;height:1.28em><svg xmlns=http://www.w3.org/2000/svg width=400em height=1.28em viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119 c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120 c340,-704.7,510.7,-1060.3,512,-1067 l0 -0 c4.7,-7.3,11,-11,19,-11 H40000v40H1012.3 s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232 c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1 s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26 c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z M1001 80h400000v40h-400000z"></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2561em></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.24em;vertical-align:-.2561em></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.9839em><span class=svg-align style=top:-3.2em><span class=pstrut style=height:3.2em></span><span class=mord style=padding-left:1em><span class=mord>−</span><span class=mspace style=margin-right:.1667em></span><span class=mop>ln</span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.03785em>δ</span><span class=mclose>)</span></span></span><span style=top:-2.9439em><span class=pstrut style=height:3.2em></span><span class=hide-tail style=min-width:1.02em;height:1.28em><svg xmlns=http://www.w3.org/2000/svg width=400em height=1.28em viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119 c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120 c340,-704.7,510.7,-1060.3,512,-1067 l0 -0 c4.7,-7.3,11,-11,19,-11 H40000v40H1012.3 s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232 c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1 s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26 c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z M1001 80h400000v40h-400000z"></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2561em></span></span></span></span><span class=mspace style=margin-right:.5em></span><span class="mord mathnormal" style=margin-right:.03588em>σ</span></span></span></span> <br></p> <br> With &delta; = FLT_MIN, we arive at: <pre><code>    span = 10.16262416423198497411 * sigma
</code></pre> <p>And can better control the accuracy via:</p> <pre><code>    span = ceil(10.16262416423198497411 * sigma * accuracy)
</code></pre> <p>Which being linear feels more intuitive, artefacts don't <em>really</em> start showing up until &lt; 50%, and the span covered could be reduced as the pixel values decrease (although this hasn't been implemented here).</p> <p>Example of the first 64 chosen samples using different accuracies, with σ=1.9:</p> <div class=sigmaVisContainer> <div><img alt=acc0.1 src=res/acc0.1.png><br>acc = 0.1</div> <div><img alt=acc0.2 src=res/acc0.2.png><br>acc = 0.2</div> <div><img alt=acc0.3 src=res/acc0.3.png><br>acc = 0.3</div> <div><img alt=acc0.4 src=res/acc0.4.png><br>acc = 0.4</div> <div><img alt=acc0.5 src=res/acc0.5.png><br>acc = 0.5</div> <div><img alt=acc1.0 src=res/acc1.0.png><br>acc = 1.0</div> </div> <p>As a note, atleast using WebGL2 (with only fragment shaders) on a PC, the time saved by limiting the region seems negligible. If we were updating regions using a compute shader this might be a different story, but even so, it's unlikely we'll ever really saturate the waves available without being bottlenecked by the reduction step first.</p> <br> <hr> <p>The full Javascript/WebGL2 stuff can be viewed here: <a target=_blank href=https://github.com/alister-chowdhury/alister-chowdhury.github.io/blob/master/_source/posts/20221230_bluenoise/void_and_cluster_webgl2.js>void_and_cluster_webgl2.js</a>.<br> It's worth mentioning, I primarily program in C++/HLSL/GLSL which is probably apparent to anyone more familiar with JS.<br></p> <br> Also for funsies here is a shadertoy port: <a target=_blank href=https://www.shadertoy.com/view/cdfSD8>https://www.shadertoy.com/view/cdfSD8</a><br> </main> <script>function vpResizeBegin(e){"mousedown"==e.type?(document.documentElement.addEventListener("mousemove",vpResizeIter,!1),document.documentElement.addEventListener("mouseup",vpResizeEnd,!1)):(document.documentElement.addEventListener("touchmove",vpResizeIter,!1),document.documentElement.addEventListener("touchend",vpResizeEnd,!1))}function vpResizeIter(e){var t=document.getElementById("viewportWrapper");let n=t.getBoundingClientRect();document.getElementById("viewportResizer");var i="mousemove"==e.type?e.clientX:e.touches[0].clientX,o="mousemove"==e.type?e.clientY:e.touches[0].clientY;t.style.width=`${Math.max(1,Math.round(i-n.x+11))}px`,t.style.height=`${Math.max(1,Math.round(o-n.y+11))}px`}function vpResizeEnd(e){"mouseup"==e.type?(document.documentElement.removeEventListener("mousemove",vpResizeIter,!1),document.documentElement.removeEventListener("mouseup",vpResizeEnd,!1)):(document.documentElement.removeEventListener("touchmove",vpResizeIter,!1),document.documentElement.removeEventListener("touchend",vpResizeEnd,!1))}function vpSizeInit(){var e=document.getElementById("viewportWrapper");let t=e.getBoundingClientRect();e.style.width=`${Math.max(1,Math.round(t.width))}px`,e.style.height=`${Math.max(1,Math.round(t.height))}px`;var n=document.getElementById("viewportResizer");n.addEventListener("mousedown",vpResizeBegin,!1),n.addEventListener("touchstart",vpResizeBegin,!1)}vpSizeInit();</script> <hr id=footersep> <div id=copyright>With the exception of third-party libraries / resources, code is public domain. Text &copy; Alister Chowdhury.</div> </body></html>