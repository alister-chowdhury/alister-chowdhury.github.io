/*! UPNG.js https://github.com/photopea/UPNG.js @license (MIT) */
var UPNG={};UPNG.toRGBA8=function(e){var r=e.width,t=e.height;if(null==e.tabs.acTL)return[UPNG.toRGBA8.decodeImage(e.data,r,t,e).buffer];var n=[];null==e.frames[0].data&&(e.frames[0].data=e.data);for(var a=r*t*4,_=new Uint8Array(a),$=new Uint8Array(a),f=new Uint8Array(a),i=0;i<e.frames.length;i++){var o=e.frames[i],l=o.rect.x,s=o.rect.y,v=o.rect.width,c=o.rect.height,u=UPNG.toRGBA8.decodeImage(o.data,v,c,e);if(0!=i)for(var d=0;d<a;d++)f[d]=_[d];if(0==o.blend?UPNG._copyTile(u,v,c,_,r,t,l,s,0):1==o.blend&&UPNG._copyTile(u,v,c,_,r,t,l,s,1),n.push(_.buffer.slice(0)),0==o.dispose);else if(1==o.dispose)UPNG._copyTile($,v,c,_,r,t,l,s,0);else if(2==o.dispose)for(var d=0;d<a;d++)_[d]=f[d]}return n},UPNG.toRGBA8.decodeImage=function(e,r,t,n){var a=r*t,_=Math.ceil(r*UPNG.decode._getBPP(n)/8),$=new Uint8Array(4*a),f=new Uint32Array($.buffer),i=n.ctype,o=n.depth,l=UPNG._bin.readUshort;if(Date.now(),6==i){var s=a<<2;if(8==o)for(var v=0;v<s;v+=4)$[v]=e[v],$[v+1]=e[v+1],$[v+2]=e[v+2],$[v+3]=e[v+3];if(16==o)for(var v=0;v<s;v++)$[v]=e[v<<1]}else if(2==i){var c=n.tabs.tRNS;if(null==c){if(8==o)for(var v=0;v<a;v++){var u=3*v;f[v]=-16777216|e[u+2]<<16|e[u+1]<<8|e[u]}if(16==o)for(var v=0;v<a;v++){var u=6*v;f[v]=-16777216|e[u+4]<<16|e[u+2]<<8|e[u]}}else{var d=c[0],h=c[1],g=c[2];if(8==o)for(var v=0;v<a;v++){var N=v<<2,u=3*v;f[v]=-16777216|e[u+2]<<16|e[u+1]<<8|e[u],e[u]==d&&e[u+1]==h&&e[u+2]==g&&($[N+3]=0)}if(16==o)for(var v=0;v<a;v++){var N=v<<2,u=6*v;f[v]=-16777216|e[u+4]<<16|e[u+2]<<8|e[u],l(e,u)==d&&l(e,u+2)==h&&l(e,u+4)==g&&($[N+3]=0)}}}else if(3==i){var U=n.tabs.PLTE,P=n.tabs.tRNS,p=P?P.length:0;if(1==o)for(var G=0;G<t;G++)for(var b=G*_,w=G*r,v=0;v<r;v++){var N=w+v<<2,m=e[b+(v>>3)]>>7-((7&v)<<0)&1,y=3*m;$[N]=U[y],$[N+1]=U[y+1],$[N+2]=U[y+2],$[N+3]=m<p?P[m]:255}if(2==o)for(var G=0;G<t;G++)for(var b=G*_,w=G*r,v=0;v<r;v++){var N=w+v<<2,m=e[b+(v>>2)]>>6-((3&v)<<1)&3,y=3*m;$[N]=U[y],$[N+1]=U[y+1],$[N+2]=U[y+2],$[N+3]=m<p?P[m]:255}if(4==o)for(var G=0;G<t;G++)for(var b=G*_,w=G*r,v=0;v<r;v++){var N=w+v<<2,m=e[b+(v>>1)]>>4-((1&v)<<2)&15,y=3*m;$[N]=U[y],$[N+1]=U[y+1],$[N+2]=U[y+2],$[N+3]=m<p?P[m]:255}if(8==o)for(var v=0;v<a;v++){var N=v<<2,m=e[v],y=3*m;$[N]=U[y],$[N+1]=U[y+1],$[N+2]=U[y+2],$[N+3]=m<p?P[m]:255}}else if(4==i){if(8==o)for(var v=0;v<a;v++){var N=v<<2,x=v<<1,H=e[x];$[N]=H,$[N+1]=H,$[N+2]=H,$[N+3]=e[x+1]}if(16==o)for(var v=0;v<a;v++){var N=v<<2,x=v<<2,H=e[x];$[N]=H,$[N+1]=H,$[N+2]=H,$[N+3]=e[x+2]}}else if(0==i)for(var d=n.tabs.tRNS?n.tabs.tRNS:-1,G=0;G<t;G++){var q=G*_,I=G*r;if(1==o)for(var T=0;T<r;T++){var H=255*(e[q+(T>>>3)]>>>7-(7&T)&1),R=H==255*d?0:255;f[I+T]=R<<24|H<<16|H<<8|H}else if(2==o)for(var T=0;T<r;T++){var H=85*(e[q+(T>>>2)]>>>6-((3&T)<<1)&3),R=H==85*d?0:255;f[I+T]=R<<24|H<<16|H<<8|H}else if(4==o)for(var T=0;T<r;T++){var H=17*(e[q+(T>>>1)]>>>4-((1&T)<<2)&15),R=H==17*d?0:255;f[I+T]=R<<24|H<<16|H<<8|H}else if(8==o)for(var T=0;T<r;T++){var H=e[q+T],R=H==d?0:255;f[I+T]=R<<24|H<<16|H<<8|H}else if(16==o)for(var T=0;T<r;T++){var H=e[q+(T<<1)],R=l(e,q+(T<<1))==d?0:255;f[I+T]=R<<24|H<<16|H<<8|H}}return $},UPNG.decode=function(e){for(var r,t=new Uint8Array(e),n=8,a=UPNG._bin,_=a.readUshort,$=a.readUint,f={tabs:{},frames:[]},i=new Uint8Array(t.length),o=0,l=0,s=[137,80,78,71,13,10,26,10],v=0;v<8;v++)if(t[v]!=s[v])throw"The input is not a PNG file!";for(;n<t.length;){var c=a.readUint(t,n);n+=4;var u=a.readASCII(t,n,4);if(n+=4,"IHDR"==u)UPNG.decode._IHDR(t,n,f);else if("CgBI"==u)f.tabs[u]=t.slice(n,n+4);else if("IDAT"==u){for(var v=0;v<c;v++)i[o+v]=t[n+v];o+=c}else if("acTL"==u)f.tabs[u]={num_frames:$(t,n),num_plays:$(t,n+4)},r=new Uint8Array(t.length);else if("fcTL"==u){if(0!=l){var d=f.frames[f.frames.length-1];d.data=UPNG.decode._decompress(f,r.slice(0,l),d.rect.width,d.rect.height),l=0}var h={x:$(t,n+12),y:$(t,n+16),width:$(t,n+4),height:$(t,n+8)},g=_(t,n+22);g=_(t,n+20)/(0==g?100:g);var N={rect:h,delay:Math.round(1e3*g),dispose:t[n+24],blend:t[n+25]};f.frames.push(N)}else if("fdAT"==u){for(var v=0;v<c-4;v++)r[l+v]=t[n+v+4];l+=c-4}else if("pHYs"==u)f.tabs[u]=[a.readUint(t,n),a.readUint(t,n+4),t[n+8]];else if("cHRM"==u){f.tabs[u]=[];for(var v=0;v<8;v++)f.tabs[u].push(a.readUint(t,n+4*v))}else if("tEXt"==u||"zTXt"==u){null==f.tabs[u]&&(f.tabs[u]={});var U,P=a.nextZero(t,n),p=a.readASCII(t,n,P-n),G=n+c-P-1;if("tEXt"==u)U=a.readASCII(t,P+1,G);else{var b=UPNG.decode._inflate(t.slice(P+2,P+2+G));U=a.readUTF8(b,0,b.length)}f.tabs[u][p]=U}else if("iTXt"==u){null==f.tabs[u]&&(f.tabs[u]={});var P=0,w=n;P=a.nextZero(t,w);var p=a.readASCII(t,w,P-w),m=t[w=P+1];t[w+1],w+=2,P=a.nextZero(t,w);var y=a.readASCII(t,w,P-w);w=P+1,P=a.nextZero(t,w);var U,x=a.readUTF8(t,w,P-w),G=c-((w=P+1)-n);if(0==m)U=a.readUTF8(t,w,G);else{var b=UPNG.decode._inflate(t.slice(w,w+G));U=a.readUTF8(b,0,b.length)}f.tabs[u][p]=U}else if("PLTE"==u)f.tabs[u]=a.readBytes(t,n,c);else if("hIST"==u){var H=f.tabs.PLTE.length/3;f.tabs[u]=[];for(var v=0;v<H;v++)f.tabs[u].push(_(t,n+2*v))}else if("tRNS"==u)3==f.ctype?f.tabs[u]=a.readBytes(t,n,c):0==f.ctype?f.tabs[u]=_(t,n):2==f.ctype&&(f.tabs[u]=[_(t,n),_(t,n+2),_(t,n+4)]);else if("gAMA"==u)f.tabs[u]=a.readUint(t,n)/1e5;else if("sRGB"==u)f.tabs[u]=t[n];else if("bKGD"==u)0==f.ctype||4==f.ctype?f.tabs[u]=[_(t,n)]:2==f.ctype||6==f.ctype?f.tabs[u]=[_(t,n),_(t,n+2),_(t,n+4)]:3==f.ctype&&(f.tabs[u]=t[n]);else if("IEND"==u)break;n+=c;var q=a.readUint(t,n);n+=4}if(0!=l){var d=f.frames[f.frames.length-1];d.data=UPNG.decode._decompress(f,r.slice(0,l),d.rect.width,d.rect.height)}return f.data=UPNG.decode._decompress(f,i,f.width,f.height),delete f.compress,delete f.interlace,delete f.filter,f},UPNG.decode._decompress=function(e,r,t,n){Date.now();var a=UPNG.decode._getBPP(e),_=new Uint8Array((Math.ceil(t*a/8)+1+e.interlace)*n);return r=e.tabs.CgBI?UPNG.inflateRaw(r,_):UPNG.decode._inflate(r,_),Date.now(),0==e.interlace?r=UPNG.decode._filterZero(r,e,0,t,n):1==e.interlace&&(r=UPNG.decode._readInterlace(r,e)),r},UPNG.decode._inflate=function(e,r){return UPNG.inflateRaw(new Uint8Array(e.buffer,2,e.length-6),r)},UPNG.inflateRaw=function(){var e,r,t={};return t.H={},t.H.N=function(e,r){var n,a,_=Uint8Array,$=0,f=0,i=0,o=0,l=0,s=0,v=0,c=0,u=0;if(3==e[0]&&0==e[1])return r||new _(0);var d=t.H,h=d.b,g=d.e,N=d.R,U=d.n,P=d.A,p=d.Z,G=d.m,b=null==r;for(b&&(r=new _(e.length>>>2<<5));0==$;){if($=h(e,u,1),f=h(e,u+1,2),u+=3,0==f){(7&u)!=0&&(u+=8-(7&u));var w=(u>>>3)+4,m=e[w-4]|e[w-3]<<8;b&&(r=t.H.W(r,c+m)),r.set(new _(e.buffer,e.byteOffset+w,m),c),u=w+m<<3,c+=m;continue}if(b&&(r=t.H.W(r,c+131072)),1==f&&(n=G.J,a=G.h,s=511,v=31),2==f){i=g(e,u,5)+257,o=g(e,u+5,5)+1,l=g(e,u+10,4)+4;for(var y=u+=14,x=1,H=0;H<38;H+=2)G.Q[H]=0,G.Q[H+1]=0;for(var H=0;H<l;H++){var q=g(e,u+3*H,3);G.Q[(G.X[H]<<1)+1]=q,q>x&&(x=q)}u+=3*l,U(G.Q,x),P(G.Q,x,G.u),n=G.w,a=G.d,u=N(G.u,(1<<x)-1,i+o,e,u,G.v);var I=d.V(G.v,0,i,G.C);s=(1<<I)-1;var T=d.V(G.v,i,o,G.D);v=(1<<T)-1,U(G.C,I),P(G.C,I,n),U(G.D,T),P(G.D,T,a)}for(;;){var R=n[p(e,u)&s];u+=15&R;var z=R>>>4;if(z>>>8==0)r[c++]=z;else if(256==z)break;else{var A=c+z-254;if(z>264){var D=G.q[z-257];A=c+(D>>>3)+g(e,u,7&D),u+=7&D}var B=a[p(e,u)&v];u+=15&B;var C=B>>>4,S=G.c[C],L=(S>>>4)+h(e,u,15&S);for(u+=15&S;c<A;)r[c]=r[c++-L],r[c]=r[c++-L],r[c]=r[c++-L],r[c]=r[c++-L];c=A}}}return r.length==c?r:r.slice(0,c)},t.H.W=function(e,r){var t=e.length;if(r<=t)return e;var n=new Uint8Array(t<<1);return n.set(e,0),n},t.H.R=function(e,r,n,a,_,$){for(var f=t.H.e,i=t.H.Z,o=0;o<n;){var l=e[i(a,_)&r];_+=15&l;var s=l>>>4;if(s<=15)$[o]=s,o++;else{var v=0,c=0;16==s?(c=3+f(a,_,2),_+=2,v=$[o-1]):17==s?(c=3+f(a,_,3),_+=3):18==s&&(c=11+f(a,_,7),_+=7);for(var u=o+c;o<u;)$[o]=v,o++}}return _},t.H.V=function(e,r,t,n){for(var a=0,_=0,$=n.length>>>1;_<t;){var f=e[_+r];n[_<<1]=0,n[(_<<1)+1]=f,f>a&&(a=f),_++}for(;_<$;)n[_<<1]=0,n[(_<<1)+1]=0,_++;return a},t.H.n=function(e,r){for(var n,a,_,$,f,i=t.H.m,o=e.length,l=i.j,$=0;$<=r;$++)l[$]=0;for($=1;$<o;$+=2)l[e[$]]++;var s=i.K;for(a=1,n=0,l[0]=0;a<=r;a++)n=n+l[a-1]<<1,s[a]=n;for(_=0;_<o;_+=2)0!=(f=e[_+1])&&(e[_]=s[f],s[f]++)},t.H.A=function(e,r,n){for(var a=e.length,_=t.H.m.r,$=0;$<a;$+=2)if(0!=e[$+1])for(var f=$>>1,i=e[$+1],o=f<<4|i,l=r-i,s=e[$]<<l,v=s+(1<<l);s!=v;)n[_[s]>>>15-r]=o,s++},t.H.l=function(e,r){for(var n=t.H.m.r,a=15-r,_=0;_<e.length;_+=2){var $=e[_]<<r-e[_+1];e[_]=n[$]>>>a}},t.H.M=function(e,r,t){t<<=7&r;var n=r>>>3;e[n]|=t,e[n+1]|=t>>>8},t.H.I=function(e,r,t){t<<=7&r;var n=r>>>3;e[n]|=t,e[n+1]|=t>>>8,e[n+2]|=t>>>16},t.H.e=function(e,r,t){return(e[r>>>3]|e[(r>>>3)+1]<<8)>>>(7&r)&(1<<t)-1},t.H.b=function(e,r,t){return(e[r>>>3]|e[(r>>>3)+1]<<8|e[(r>>>3)+2]<<16)>>>(7&r)&(1<<t)-1},t.H.Z=function(e,r){return(e[r>>>3]|e[(r>>>3)+1]<<8|e[(r>>>3)+2]<<16)>>>(7&r)},t.H.i=function(e,r){return(e[r>>>3]|e[(r>>>3)+1]<<8|e[(r>>>3)+2]<<16|e[(r>>>3)+3]<<24)>>>(7&r)},t.H.m=(e=Uint16Array,r=Uint32Array,{K:new e(16),j:new e(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new e(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new e(512),_:[],h:new e(32),$:[],w:new e(32768),C:[],v:[],d:new e(32768),D:[],u:new e(512),Q:[],r:new e(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new e(65536),g:new e(32768)}),function(){for(var e=t.H.m,r=0;r<32768;r++){var n=r;n=(4278255360&(n=(4042322160&(n=(3435973836&(n=(2863311530&n)>>>1|(1431655765&n)<<1))>>>2|(858993459&n)<<2))>>>4|(252645135&n)<<4))>>>8|(16711935&n)<<8,e.r[r]=(n>>>16|n<<16)>>>17}function a(e,r,t){for(;0!=r--;)e.push(0,t)}for(var r=0;r<32;r++)e.q[r]=e.S[r]<<3|e.T[r],e.c[r]=e.p[r]<<4|e.z[r];a(e._,144,8),a(e._,112,9),a(e._,24,7),a(e._,8,8),t.H.n(e._,9),t.H.A(e._,9,e.J),t.H.l(e._,9),a(e.$,32,5),t.H.n(e.$,5),t.H.A(e.$,5,e.h),t.H.l(e.$,5),a(e.Q,19,0),a(e.C,286,0),a(e.D,30,0),a(e.v,320,0)}(),t.H.N}(),UPNG.decode._readInterlace=function(e,r){for(var t=r.width,n=r.height,a=UPNG.decode._getBPP(r),_=a>>3,$=Math.ceil(t*a/8),f=new Uint8Array(n*$),i=0,o=[0,0,4,0,2,0,1],l=[0,4,0,2,0,1,0],s=[8,8,8,4,4,2,2],v=[8,8,4,4,2,2,1],c=0;c<7;){for(var u=s[c],d=v[c],h=0,g=0,N=o[c];N<n;)N+=u,g++;for(var U=l[c];U<t;)U+=d,h++;var P=Math.ceil(h*a/8);UPNG.decode._filterZero(e,r,i,h,g);for(var p=0,G=o[c];G<n;){for(var b=l[c],w=i+p*P<<3;b<t;){if(1==a){var m=e[w>>3];m=m>>7-(7&w)&1,f[G*$+(b>>3)]|=m<<7-((7&b)<<0)}if(2==a){var m=e[w>>3];m=m>>6-(7&w)&3,f[G*$+(b>>2)]|=m<<6-((3&b)<<1)}if(4==a){var m=e[w>>3];m=m>>4-(7&w)&15,f[G*$+(b>>1)]|=m<<4-((1&b)<<2)}if(a>=8)for(var y=G*$+b*_,x=0;x<_;x++)f[y+x]=e[(w>>3)+x];w+=a,b+=d}p++,G+=u}h*g!=0&&(i+=g*(1+P)),c+=1}return f},UPNG.decode._getBPP=function(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth},UPNG.decode._filterZero=function(e,r,t,n,a){var _=UPNG.decode._getBPP(r),$=Math.ceil(n*_/8),f=UPNG.decode._paeth;_=Math.ceil(_/8);var i,o,l=e[t],s=0;if(l>1&&(e[t]=[0,0,1][l-2]),3==l)for(s=_;s<$;s++)e[s+1]=e[s+1]+(e[s+1-_]>>>1)&255;for(var v=0;v<a;v++)if(l=e[(o=(i=t+v*$)+v+1)-1],s=0,0==l)for(;s<$;s++)e[i+s]=e[o+s];else if(1==l){for(;s<_;s++)e[i+s]=e[o+s];for(;s<$;s++)e[i+s]=e[o+s]+e[i+s-_]}else if(2==l)for(;s<$;s++)e[i+s]=e[o+s]+e[i+s-$];else if(3==l){for(;s<_;s++)e[i+s]=e[o+s]+(e[i+s-$]>>>1);for(;s<$;s++)e[i+s]=e[o+s]+(e[i+s-$]+e[i+s-_]>>>1)}else{for(;s<_;s++)e[i+s]=e[o+s]+f(0,e[i+s-$],0);for(;s<$;s++)e[i+s]=e[o+s]+f(e[i+s-_],e[i+s-$],e[i+s-_-$])}return e},UPNG.decode._paeth=function(e,r,t){var n=e+r-t,a=n-e,_=n-r,$=n-t;return a*a<=_*_&&a*a<=$*$?e:_*_<=$*$?r:t},UPNG.decode._IHDR=function(e,r,t){var n=UPNG._bin;t.width=n.readUint(e,r),r+=4,t.height=n.readUint(e,r),r+=4,t.depth=e[r],r++,t.ctype=e[r],r++,t.compress=e[r],r++,t.filter=e[r],r++,t.interlace=e[r],r++},UPNG._bin={nextZero:function(e,r){for(;0!=e[r];)r++;return r},readUshort:function(e,r){return e[r]<<8|e[r+1]},writeUshort:function(e,r,t){e[r]=t>>8&255,e[r+1]=255&t},readUint:function(e,r){return 16777216*e[r]+(e[r+1]<<16|e[r+2]<<8|e[r+3])},writeUint:function(e,r,t){e[r]=t>>24&255,e[r+1]=t>>16&255,e[r+2]=t>>8&255,e[r+3]=255&t},readASCII:function(e,r,t){for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[r+a]);return n},writeASCII:function(e,r,t){for(var n=0;n<t.length;n++)e[r+n]=t.charCodeAt(n)},readBytes:function(e,r,t){for(var n=[],a=0;a<t;a++)n.push(e[r+a]);return n},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,r,t){for(var n,a="",_=0;_<t;_++)a+="%"+UPNG._bin.pad(e[r+_].toString(16));try{n=decodeURIComponent(a)}catch($){return UPNG._bin.readASCII(e,r,t)}return n}},UPNG._copyTile=function(e,r,t,n,a,_,$,f,i){for(var o=Math.min(r,a),l=Math.min(t,_),s=0,v=0,c=0;c<l;c++)for(var u=0;u<o;u++)if($>=0&&f>=0?(s=c*r+u<<2,v=(f+c)*a+$+u<<2):(s=(-f+c)*r-$+u<<2,v=c*a+u<<2),0==i)n[v]=e[s],n[v+1]=e[s+1],n[v+2]=e[s+2],n[v+3]=e[s+3];else if(1==i){var d=e[s+3]*(1/255),h=e[s]*d,g=e[s+1]*d,N=e[s+2]*d,U=n[v+3]*(1/255),P=n[v]*U,p=n[v+1]*U,G=n[v+2]*U,b=1-d,w=d+U*b,m=0==w?0:1/w;n[v+3]=255*w,n[v+0]=(h+P*b)*m,n[v+1]=(g+p*b)*m,n[v+2]=(N+G*b)*m}else if(2==i){var d=e[s+3],h=e[s],g=e[s+1],N=e[s+2],U=n[v+3],P=n[v],p=n[v+1],G=n[v+2];d==U&&h==P&&g==p&&N==G?(n[v]=0,n[v+1]=0,n[v+2]=0,n[v+3]=0):(n[v]=h,n[v+1]=g,n[v+2]=N,n[v+3]=d)}else if(3==i){var d=e[s+3],h=e[s],g=e[s+1],N=e[s+2],U=n[v+3],P=n[v],p=n[v+1],G=n[v+2];if(d==U&&h==P&&g==p&&N==G)continue;if(d<220&&U>20)return!1}return!0},UPNG.encode=function(e,r,t,n,a,_,$){null==n&&(n=0),null==$&&($=!1);var f=UPNG.encode.compress(e,r,t,n,[!1,!1,!1,0,$,!1]);return UPNG.encode.compressPNG(f,-1),UPNG.encode._main(f,r,t,a,_)},UPNG.encodeLL=function(e,r,t,n,a,_,$,f){var i={ctype:0+(1==n?0:2)+(0==a?0:4),depth:_,frames:[]};Date.now();for(var o=(n+a)*_,l=o*r,s=0;s<e.length;s++)i.frames.push({rect:{x:0,y:0,width:r,height:t},img:new Uint8Array(e[s]),blend:0,dispose:1,bpp:Math.ceil(o/8),bpl:Math.ceil(l/8)});return UPNG.encode.compressPNG(i,0,!0),UPNG.encode._main(i,r,t,$,f)},UPNG.encode._main=function(e,r,t,n,a){null==a&&(a={});var _=UPNG.crc.crc,$=UPNG._bin.writeUint,f=UPNG._bin.writeUshort,i=UPNG._bin.writeASCII,o=8,l=e.frames.length>1,s=!1,v=33+(l?20:0);if(null!=a.sRGB&&(v+=13),null!=a.pHYs&&(v+=21),3==e.ctype){for(var c=e.plte.length,u=0;u<c;u++)e.plte[u]>>>24!=255&&(s=!0);v+=8+3*c+4+(s?8+1*c+4:0)}for(var d=0;d<e.frames.length;d++){var h=e.frames[d];l&&(v+=38),v+=h.cimg.length+12,0!=d&&(v+=4)}v+=12;for(var g=new Uint8Array(v),N=[137,80,78,71,13,10,26,10],u=0;u<8;u++)g[u]=N[u];if($(g,o,13),i(g,o+=4,"IHDR"),$(g,o+=4,r),$(g,o+=4,t),g[o+=4]=e.depth,g[++o]=e.ctype,g[++o]=0,g[++o]=0,g[++o]=0,$(g,++o,_(g,o-17,17)),o+=4,null!=a.sRGB&&($(g,o,1),i(g,o+=4,"sRGB"),g[o+=4]=a.sRGB,$(g,++o,_(g,o-5,5)),o+=4),null!=a.pHYs&&($(g,o,9),i(g,o+=4,"pHYs"),$(g,o+=4,a.pHYs[0]),$(g,o+=4,a.pHYs[1]),g[o+=4]=a.pHYs[2],$(g,++o,_(g,o-13,13)),o+=4),l&&($(g,o,8),i(g,o+=4,"acTL"),$(g,o+=4,e.frames.length),$(g,o+=4,null!=a.loop?a.loop:0),$(g,o+=4,_(g,o-12,12)),o+=4),3==e.ctype){var c=e.plte.length;$(g,o,3*c),i(g,o+=4,"PLTE"),o+=4;for(var u=0;u<c;u++){var U=3*u,P=e.plte[u],p=255&P,G=P>>>8&255,b=P>>>16&255;g[o+U+0]=p,g[o+U+1]=G,g[o+U+2]=b}if($(g,o+=3*c,_(g,o-3*c-4,3*c+4)),o+=4,s){$(g,o,c),i(g,o+=4,"tRNS"),o+=4;for(var u=0;u<c;u++)g[o+u]=e.plte[u]>>>24&255;$(g,o+=c,_(g,o-c-4,c+4)),o+=4}}for(var w=0,d=0;d<e.frames.length;d++){var h=e.frames[d];l&&($(g,o,26),i(g,o+=4,"fcTL"),$(g,o+=4,w++),$(g,o+=4,h.rect.width),$(g,o+=4,h.rect.height),$(g,o+=4,h.rect.x),$(g,o+=4,h.rect.y),f(g,o+=4,n[d]),f(g,o+=2,1e3),g[o+=2]=h.dispose,g[++o]=h.blend,$(g,++o,_(g,o-30,30)),o+=4);var m=h.cimg,c=m.length;$(g,o,c+(0==d?0:4));var y=o+=4;i(g,o,0==d?"IDAT":"fdAT"),o+=4,0!=d&&($(g,o,w++),o+=4),g.set(m,o),$(g,o+=c,_(g,y,o-y)),o+=4}return $(g,o,0),i(g,o+=4,"IEND"),$(g,o+=4,_(g,o-4,4)),o+=4,g.buffer},UPNG.encode.compressPNG=function(e,r,t){for(var n=0;n<e.frames.length;n++){var a=e.frames[n],_=(a.rect.width,a.rect.height),$=new Uint8Array(_*a.bpl+_);a.cimg=UPNG.encode._filterZero(a.img,_,a.bpp,a.bpl,$,r,t)}},UPNG.encode.compress=function(e,r,t,n,a){for(var _=a[0],$=a[1],f=a[2],i=a[3],o=a[4],l=a[5],s=6,v=8,c=255,u=0;u<e.length;u++)for(var d=new Uint8Array(e[u]),h=d.length,g=0;g<h;g+=4)c&=d[g+3];var N=255!=c,U=UPNG.encode.framize(e,r,t,_,$,f),P={},p=[],G=[];if(0!=n){for(var b=[],g=0;g<U.length;g++)b.push(U[g].img.buffer);for(var w=UPNG.encode.concatRGBA(b),m=UPNG.quantize(w,n),g=0;g<m.plte.length;g++)p.push(m.plte[g].est.rgba);for(var y=0,g=0;g<U.length;g++){var x=U[g],H=x.img.length,q=new Uint8Array(m.inds.buffer,y>>2,H>>2);G.push(q);var I=new Uint8Array(m.abuf,y,H);l&&UPNG.encode.dither(x.img,x.rect.width,x.rect.height,p,I,q),x.img.set(I),y+=H}}else for(var u=0;u<U.length;u++){var x=U[u],T=new Uint32Array(x.img.buffer),R=x.rect.width,h=T.length,q=new Uint8Array(h);G.push(q);for(var g=0;g<h;g++){var z=T[g];if(0!=g&&z==T[g-1])q[g]=q[g-1];else if(g>R&&z==T[g-R])q[g]=q[g-R];else{var A=P[z];if(null==A&&(P[z]=A=p.length,p.push(z),p.length>=300))break;q[g]=A}}}var D=p.length;D<=256&&!1==o&&(v=Math.max(v=D<=2?1:D<=4?2:D<=16?4:8,i));for(var u=0;u<U.length;u++){var x=U[u],R=(x.rect.x,x.rect.y,x.rect.width),B=x.rect.height,C=x.img;new Uint32Array(C.buffer);var S=4*R,L=4;if(D<=256&&!1==o){S=Math.ceil(v*R/8);for(var Z=new Uint8Array(S*B),M=G[u],E=0;E<B;E++){var g=E*S,F=E*R;if(8==v)for(var Y=0;Y<R;Y++)Z[g+Y]=M[F+Y];else if(4==v)for(var Y=0;Y<R;Y++)Z[g+(Y>>1)]|=M[F+Y]<<4-(1&Y)*4;else if(2==v)for(var Y=0;Y<R;Y++)Z[g+(Y>>2)]|=M[F+Y]<<6-(3&Y)*2;else if(1==v)for(var Y=0;Y<R;Y++)Z[g+(Y>>3)]|=M[F+Y]<<7-(7&Y)*1}C=Z,s=3,L=1}else if(!1==N&&1==U.length){for(var Z=new Uint8Array(R*B*3),Q=R*B,g=0;g<Q;g++){var k=3*g,X=4*g;Z[k]=C[X],Z[k+1]=C[X+1],Z[k+2]=C[X+2]}C=Z,s=2,L=3,S=3*R}x.img=C,x.bpl=S,x.bpp=L}return{ctype:s,depth:v,plte:p,frames:U}},UPNG.encode.framize=function(e,r,t,n,a,_){for(var $=[],f=0;f<e.length;f++){var i,o=new Uint8Array(e[f]),l=new Uint32Array(o.buffer),s=0,v=0,c=r,u=t,d=n?1:0;if(0!=f){for(var h=_||n||1==f||0!=$[f-2].dispose?1:2,g=0,N=1e9,U=0;U<h;U++){for(var P=new Uint8Array(e[f-1-U]),p=new Uint32Array(e[f-1-U]),G=r,b=t,w=-1,m=-1,y=0;y<t;y++)for(var x=0;x<r;x++){var H=y*r+x;l[H]!=p[H]&&(x<G&&(G=x),x>w&&(w=x),y<b&&(b=y),y>m&&(m=y))}-1==w&&(G=b=w=m=0),a&&((1&G)==1&&G--,(1&b)==1&&b--);var q=(w-G+1)*(m-b+1);q<N&&(N=q,g=U,s=G,v=b,c=w-G+1,u=m-b+1)}var P=new Uint8Array(e[f-1-g]);1==g&&($[f-1].dispose=2),i=new Uint8Array(c*u*4),UPNG._copyTile(P,r,t,i,c,u,-s,-v,0),1==(d=UPNG._copyTile(o,r,t,i,c,u,-s,-v,3)?1:0)?UPNG.encode._prepareDiff(o,r,t,i,{x:s,y:v,width:c,height:u}):UPNG._copyTile(o,r,t,i,c,u,-s,-v,0)}else i=o.slice(0);$.push({rect:{x:s,y:v,width:c,height:u},img:i,blend:d,dispose:0})}if(n)for(var f=0;f<$.length;f++){var I=$[f];if(1!=I.blend){var T,R=I.rect,z=$[f-1].rect,A=Math.min(R.x,z.x),D=Math.min(R.y,z.y),B={x:A,y:D,width:Math.max(R.x+R.width,z.x+z.width)-A,height:Math.max(R.y+R.height,z.y+z.height)-D};$[f-1].dispose=1,f-1!=0&&UPNG.encode._updateFrame(e,r,t,$,f-1,B,a),UPNG.encode._updateFrame(e,r,t,$,f,B,a)}}var C=0;if(1!=e.length)for(var H=0;H<$.length;H++){var I=$[H];C+=I.rect.width*I.rect.height}return $},UPNG.encode._updateFrame=function(e,r,t,n,a,_,$){for(var f=Uint8Array,i=Uint32Array,o=new f(e[a-1]),l=new i(e[a-1]),s=a+1<e.length?new f(e[a+1]):null,v=new f(e[a]),c=new i(v.buffer),u=r,d=t,h=-1,g=-1,N=0;N<_.height;N++)for(var U=0;U<_.width;U++){var P=_.x+U,p=_.y+N,G=p*r+P,b=c[G];0==b||0==n[a-1].dispose&&l[G]==b&&(null==s||0!=s[4*G+3])||(P<u&&(u=P),P>h&&(h=P),p<d&&(d=p),p>g&&(g=p))}-1==h&&(u=d=h=g=0),$&&((1&u)==1&&u--,(1&d)==1&&d--),_={x:u,y:d,width:h-u+1,height:g-d+1};var w=n[a];w.rect=_,w.blend=1,w.img=new Uint8Array(_.width*_.height*4),0==n[a-1].dispose?(UPNG._copyTile(o,r,t,w.img,_.width,_.height,-_.x,-_.y,0),UPNG.encode._prepareDiff(v,r,t,w.img,_)):UPNG._copyTile(v,r,t,w.img,_.width,_.height,-_.x,-_.y,0)},UPNG.encode._prepareDiff=function(e,r,t,n,a){UPNG._copyTile(e,r,t,n,a.width,a.height,-a.x,-a.y,2)},UPNG.encode._filterZero=function(e,r,t,n,a,_,$){var f=[],i=[0,1,2,3,4];-1!=_?i=[_]:(r*n>5e5||1==t)&&(i=[0]),$&&(v={level:0});var o=a.length>1e7&&null!=UZIP?UZIP:pako;Date.now();for(var l=0;l<i.length;l++){for(var s=0;s<r;s++)UPNG.encode._filterLine(a,e,s,n,t,i[l]);f.push(o.deflate(a,v))}for(var v,c,u=1e9,l=0;l<f.length;l++)f[l].length<u&&(c=l,u=f[l].length);return f[c]},UPNG.encode._filterLine=function(e,r,t,n,a,_){var $=t*n,f=$+t,i=UPNG.decode._paeth;if(e[f]=_,f++,0==_){if(n<500)for(var o=0;o<n;o++)e[f+o]=r[$+o];else e.set(new Uint8Array(r.buffer,$,n),f)}else if(1==_){for(var o=0;o<a;o++)e[f+o]=r[$+o];for(var o=a;o<n;o++)e[f+o]=r[$+o]-r[$+o-a]+256&255}else if(0==t){for(var o=0;o<a;o++)e[f+o]=r[$+o];if(2==_)for(var o=a;o<n;o++)e[f+o]=r[$+o];if(3==_)for(var o=a;o<n;o++)e[f+o]=r[$+o]-(r[$+o-a]>>1)+256&255;if(4==_)for(var o=a;o<n;o++)e[f+o]=r[$+o]-i(r[$+o-a],0,0)+256&255}else{if(2==_)for(var o=0;o<n;o++)e[f+o]=r[$+o]+256-r[$+o-n]&255;if(3==_){for(var o=0;o<a;o++)e[f+o]=r[$+o]+256-(r[$+o-n]>>1)&255;for(var o=a;o<n;o++)e[f+o]=r[$+o]+256-(r[$+o-n]+r[$+o-a]>>1)&255}if(4==_){for(var o=0;o<a;o++)e[f+o]=r[$+o]+256-i(0,r[$+o-n],0)&255;for(var o=a;o<n;o++)e[f+o]=r[$+o]+256-i(r[$+o-a],r[$+o-n],r[$+o-a-n])&255}}},UPNG.crc={table:function(){for(var e=new Uint32Array(256),r=0;r<256;r++){for(var t=r,n=0;n<8;n++)1&t?t=3988292384^t>>>1:t>>>=1;e[r]=t}return e}(),update:function(e,r,t,n){for(var a=0;a<n;a++)e=UPNG.crc.table[(e^r[t+a])&255]^e>>>8;return e},crc:function(e,r,t){return 4294967295^UPNG.crc.update(4294967295,e,r,t)}},UPNG.quantize=function(e,r){var t,n=new Uint8Array(e),a=n.slice(0),_=new Uint32Array(a.buffer),$=UPNG.quantize.getKDtree(a,r),f=$[0],i=$[1],o=UPNG.quantize.planeDst,l=n.length,s=new Uint8Array(l>>2);if(n.length<2e7)for(var v=0;v<l;v+=4){var c=n[v]*(1/255),u=n[v+1]*(1/255),d=n[v+2]*(1/255),h=n[v+3]*(1/255);t=UPNG.quantize.getNearest(f,c,u,d,h),s[v>>2]=t.ind,_[v>>2]=t.est.rgba}else for(var v=0;v<l;v+=4){var c=n[v]*(1/255),u=n[v+1]*(1/255),d=n[v+2]*(1/255),h=n[v+3]*(1/255);for(t=f;t.left;)t=0>=o(t.est,c,u,d,h)?t.left:t.right;s[v>>2]=t.ind,_[v>>2]=t.est.rgba}return{abuf:a.buffer,inds:s,plte:i}},UPNG.quantize.getKDtree=function(e,r,t){null==t&&(t=1e-4);var n=new Uint32Array(e.buffer),a={i0:0,i1:e.length,bst:null,est:null,tdst:0,left:null,right:null};a.bst=UPNG.quantize.stats(e,a.i0,a.i1),a.est=UPNG.quantize.estats(a.bst);for(var _=[a];_.length<r;){for(var $=0,f=0,i=0;i<_.length;i++)_[i].est.L>$&&($=_[i].est.L,f=i);if($<t)break;var o=_[f],l=UPNG.quantize.splitPixels(e,n,o.i0,o.i1,o.est.e,o.est.eMq255);if(o.i0>=l||o.i1<=l){o.est.L=0;continue}var s={i0:o.i0,i1:l,bst:null,est:null,tdst:0,left:null,right:null};s.bst=UPNG.quantize.stats(e,s.i0,s.i1),s.est=UPNG.quantize.estats(s.bst);var v={i0:l,i1:o.i1,bst:null,est:null,tdst:0,left:null,right:null};v.bst={R:[],m:[],N:o.bst.N-s.bst.N};for(var i=0;i<16;i++)v.bst.R[i]=o.bst.R[i]-s.bst.R[i];for(var i=0;i<4;i++)v.bst.m[i]=o.bst.m[i]-s.bst.m[i];v.est=UPNG.quantize.estats(v.bst),o.left=s,o.right=v,_[f]=s,_.push(v)}_.sort(function(e,r){return r.bst.N-e.bst.N});for(var i=0;i<_.length;i++)_[i].ind=i;return[a,_]},UPNG.quantize.getNearest=function(e,r,t,n,a){if(null==e.left)return e.tdst=UPNG.quantize.dist(e.est.q,r,t,n,a),e;var _=UPNG.quantize.planeDst(e.est,r,t,n,a),$=e.left,f=e.right;_>0&&($=e.right,f=e.left);var i=UPNG.quantize.getNearest($,r,t,n,a);if(i.tdst<=_*_)return i;var o=UPNG.quantize.getNearest(f,r,t,n,a);return o.tdst<i.tdst?o:i},UPNG.quantize.planeDst=function(e,r,t,n,a){var _=e.e;return _[0]*r+_[1]*t+_[2]*n+_[3]*a-e.eMq},UPNG.quantize.dist=function(e,r,t,n,a){var _=r-e[0],$=t-e[1],f=n-e[2],i=a-e[3];return _*_+$*$+f*f+i*i},UPNG.quantize.splitPixels=function(e,r,t,n,a,_){var $=UPNG.quantize.vecDot;for(n-=4;t<n;){for(;$(e,t,a)<=_;)t+=4;for(;$(e,n,a)>_;)n-=4;if(t>=n)break;var f=r[t>>2];r[t>>2]=r[n>>2],r[n>>2]=f,t+=4,n-=4}for(;$(e,t,a)>_;)t-=4;return t+4},UPNG.quantize.vecDot=function(e,r,t){return e[r]*t[0]+e[r+1]*t[1]+e[r+2]*t[2]+e[r+3]*t[3]},UPNG.quantize.stats=function(e,r,t){for(var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=[0,0,0,0],_=r;_<t;_+=4){var $=e[_]*(1/255),f=e[_+1]*(1/255),i=e[_+2]*(1/255),o=e[_+3]*(1/255);a[0]+=$,a[1]+=f,a[2]+=i,a[3]+=o,n[0]+=$*$,n[1]+=$*f,n[2]+=$*i,n[3]+=$*o,n[5]+=f*f,n[6]+=f*i,n[7]+=f*o,n[10]+=i*i,n[11]+=i*o,n[15]+=o*o}return n[4]=n[1],n[8]=n[2],n[9]=n[6],n[12]=n[3],n[13]=n[7],n[14]=n[11],{R:n,m:a,N:t-r>>2}},UPNG.quantize.estats=function(e){var r=e.R,t=e.m,n=e.N,a=t[0],_=t[1],$=t[2],f=t[3],i=0==n?0:1/n,o=[r[0]-a*a*i,r[1]-a*_*i,r[2]-a*$*i,r[3]-a*f*i,r[4]-_*a*i,r[5]-_*_*i,r[6]-_*$*i,r[7]-_*f*i,r[8]-$*a*i,r[9]-$*_*i,r[10]-$*$*i,r[11]-$*f*i,r[12]-f*a*i,r[13]-f*_*i,r[14]-f*$*i,r[15]-f*f*i],l=o,s=UPNG.M4,v=[Math.random(),Math.random(),Math.random(),Math.random()],c=0,u=0;if(0!=n)for(var d=0;d<16&&(v=s.multVec(l,v),u=Math.sqrt(s.dot(v,v)),v=s.sml(1/u,v),!(0!=d&&1e-9>Math.abs(u-c)));d++)c=u;var h=[a*i,_*i,$*i,f*i],g=s.dot(s.sml(255,h),v);return{Cov:o,q:h,e:v,L:c,eMq255:g,eMq:s.dot(v,h),rgba:(Math.round(255*h[3])<<24|Math.round(255*h[2])<<16|Math.round(255*h[1])<<8|Math.round(255*h[0])<<0)>>>0}},UPNG.M4={multVec:function(e,r){return[e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3],e[4]*r[0]+e[5]*r[1]+e[6]*r[2]+e[7]*r[3],e[8]*r[0]+e[9]*r[1]+e[10]*r[2]+e[11]*r[3],e[12]*r[0]+e[13]*r[1]+e[14]*r[2]+e[15]*r[3]]},dot:function(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]},sml:function(e,r){return[e*r[0],e*r[1],e*r[2],e*r[3]]}},UPNG.encode.concatRGBA=function(e){for(var r=0,t=0;t<e.length;t++)r+=e[t].byteLength;for(var n=new Uint8Array(r),a=0,t=0;t<e.length;t++){for(var _=new Uint8Array(e[t]),$=_.length,f=0;f<$;f+=4){var i=_[f],o=_[f+1],l=_[f+2],s=_[f+3];0==s&&(i=o=l=0),n[a+f]=i,n[a+f+1]=o,n[a+f+2]=l,n[a+f+3]=s}a+=$}return n.buffer},UPNG.encode.dither=function(e,r,t,n,a,_){function $(e,r,t,n){r[t]+=e[0]*n>>4,r[t+1]+=e[1]*n>>4,r[t+2]+=e[2]*n>>4,r[t+3]+=e[3]*n>>4}function f(e){return Math.max(0,Math.min(255,e))}function i(e,r){var t=e[0]-r[0],n=e[1]-r[1],a=e[2]-r[2],_=e[3]-r[3];return t*t+n*n+a*a+_*_}for(var o=n.length,l=[],s=[],v=0;v<o;v++){var c=n[v];l.push([c>>>0&255,c>>>8&255,c>>>16&255,c>>>24&255])}for(var v=0;v<o;v++){for(var u=4294967295,d=0,h=0;h<o;h++){var g=i(l[v],l[h]);h!=v&&g<u&&(u=g,d=h)}var N=Math.sqrt(u)/2;s[v]=~~(N*N)}for(var U=new Uint32Array(a.buffer),P=new Int16Array(r*t*4),p=0;p<t;p++)for(var G=0;G<r;G++){for(var v=(p*r+G)*4,b=[f(e[v]+P[v]),f(e[v+1]+P[v+1]),f(e[v+2]+P[v+2]),f(e[v+3]+P[v+3])],d=0,w=16777215,h=0;h<o;h++){var m=i(b,l[h]);m<w&&(w=m,d=h)}var y=l[d],x=[b[0]-y[0],b[1]-y[1],b[2]-y[2],b[3]-y[3]];G!=r-1&&$(x,P,v+4,7),p!=t-1&&(0!=G&&$(x,P,v+4*r-4,3),$(x,P,v+4*r,5),G!=r-1&&$(x,P,v+4*r+4,1)),_[v>>2]=d,U[v>>2]=n[d]}};