class AsyncBarrier{constructor(){this.num=0,this.p=null,this.r=null}ready(){return 0==this.num}enqueue(e,t=null,n=null){let r=this;return null==r.p&&(r.p=new Promise(e=>{r.r=e})),++r.num,e.then(e=>{null!=t&&(r[t]=e),null!=n&&n.forEach(t=>{r[t]=e[t]}),0==--r.num&&r.r()}),r}async selfBarrier(){return await this.then(()=>{}),{...this}}async then(e){for(;0!=this.num;)await this.p;let t=e(this);return t}}export function loadCommonShaderSource(e,t="webgl"){return fetch("/res/shaders/compiled_"+t+"/"+e).then(e=>e.text())}export function isElementVisible(e){let t=e.getBoundingClientRect();return t.bottom>=0&&t.right>=0&&t.top<(window.innerHeight||document.documentElement.clientHeight)&&t.left<(window.innerWidth||document.documentElement.clientWidth)}export const IS_LITTLE_ENDIAN=902392147==new DataView(new Uint32Array([902392147]).buffer).getUint32(0,!0);export const loadF32Lines=IS_LITTLE_ENDIAN?async e=>fetch(e).then(e=>e.blob().then(e=>e.arrayBuffer().then(e=>new Float32Array(e)))):async e=>fetch(e).then(e=>e.blob().then(e=>e.arrayBuffer().then(e=>{let t=Math.floor(e.byteLength/4),n=new DataView(e),r=new Float32Array(t);for(let o=0;o<t;++o)r[o]=n.getFloat32(4*o,!0);return r})));export const bitcast=(()=>{let e=new Uint32Array(1),t=new Float32Array(e.buffer),n=new Float32Array(e.buffer),r=(e,t,n)=>(t[0]=e,n[0]);return{f32:e=>r(e,n,n),u32:t=>r(t,e,e),i32:e=>r(e,t,t),f32tou32:t=>r(t,n,e),u32tof32:t=>r(t,e,n),f32toi32:e=>r(e,n,t),i32tof32:e=>r(e,t,n),u32toi32:n=>r(n,e,t),i32tou32:n=>r(n,t,e)}})();export const resolveChildren=e=>{let t=[],n=[],r=null;return(r=e=>{for(let[o,u]of Object.entries(e))"object"==typeof u&&(void 0!==u.then?(t.push(u),n.push([e,o])):r(u))})(e),Promise.all(t).then(t=>{for(let r=0;r<n.length;++r){let o=n[r];o[0][o[1]]=t[r]}return e})};export const createCanvasDragHandler=(e,t,n,r)=>{let o=(t,n)=>{t.preventDefault();let r=e.getBoundingClientRect(),o=n?[t.touches[0].clientX,t.touches[0].clientY]:[t.clientX,t.clientY];return[(o[0]-r.x)/r.width,1-(o[1]-r.y)/r.height]},u=u=>{if("mousedown"==u.type){let l=e=>{n(o(e,!1))},i=t=>{t.preventDefault(),e.removeEventListener("mousemove",l,!1),e.removeEventListener("mouseup",i,!1),r()};e.addEventListener("mousemove",l,!1),e.addEventListener("mouseup",i,!1),t(o(u,!1))}else{let s=e=>{n(o(e,!0))},h=t=>{t.preventDefault(),e.removeEventListener("touchmove",s,!1),e.removeEventListener("touchend",h,!1)};e.addEventListener("touchmove",s,!1),e.addEventListener("touchend",h,!1),s(u)}};e.addEventListener("mousedown",u,!1),e.addEventListener("touchstart",u,!1)};export{AsyncBarrier};