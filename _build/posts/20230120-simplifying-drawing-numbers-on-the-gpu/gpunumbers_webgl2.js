import{AsyncBarrier as e,loadCommonShaderSource as r}from"../../util.js";import{createShader as t,createGraphicsProgram as n,getUniformLocation as o,createDummyVAO as d,deleteShaders as u}from"../../webgl_util.js";function loadShaderSource(e){return fetch("./shaders/compiled/"+e).then(e=>e.text())}export const paddedHexify=e=>e.toString(16).padStart(8,"0");export function decodeToString(e){let r="";for(let t=0;t<8;++t,e>>=4)r+="0123456789e.+-# "[15&e];return r}export let encodeNumber;let _RESOURCES=new e().enqueue(r("draw_full_screen_uvs.vert"),"DRAW_NUMBER_VS_SRC").enqueue(loadShaderSource("draw_number.frag"),"DRAW_NUMBER_FS_SRC").enqueue(WebAssembly.instantiateStreaming(fetch("/res/encode_number_web.wasm")).then(e=>{let r=e.instance.exports;r.init(),encodeNumber=e=>r.encodeNumber(e)>>>0}),"encodeNumber");class DrawNumbersCanvasContext{constructor(e){let r=e.getContext("webgl2");if(this.valid=!!r,!this.valid)return;let i=t(r,_RESOURCES.DRAW_NUMBER_VS_SRC,r.VERTEX_SHADER),a=t(r,_RESOURCES.DRAW_NUMBER_FS_SRC,r.FRAGMENT_SHADER),l=n(r,i,a),s={encodedNumber:o(r,l,"encodedNumber"),bgCol:o(r,l,"bgCol"),fgCol:o(r,l,"fgCol")};u(r,i,a),r.viewport(0,0,e.clientWidth,e.clientHeight),r.disable(r.DEPTH_TEST),r.disable(r.BLEND),r.useProgram(l),r.bindVertexArray(d(r)),this.render=(e,t,n)=>{r.uniform1ui(s.encodedNumber,e),r.uniform3f(s.bgCol,t[0],t[1],t[2]),r.uniform3f(s.fgCol,n[0],n[1],n[2]),r.drawArrays(r.TRIANGLES,0,3)}}}export function bindDrawNumbersContext(e){return void 0==e.drawCtx&&(e.drawCtx=new DrawNumbersCanvasContext(e)),e.drawCtx}export function onResourcesLoaded(e){return _RESOURCES.then(e)}